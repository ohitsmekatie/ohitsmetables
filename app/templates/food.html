{% extends "base.html" %}

{% block content %}
  <div class="text-center">
    <h1 class="mb-4 display-5">
      <i class="fas fa-drumstick-bite me-2"></i> Food Generator
    </h1>

    <div class="form-check form-check-inline">
      <input class="form-check-input" type="checkbox" id="includeWeird">
      <label class="form-check-label" for="includeWeird">Weird Side Effect</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="checkbox" id="includeMagical">
      <label class="form-check-label" for="includeMagical">Magical Side Effect</label>
    </div>

    <div class="mt-4">
      <button id="generateEncounterBtn" class="btn btn-primary mb-4">
        <i class="fas fa-wand-sparkles me-2"></i> Generate Food
      </button>
    </div>

    <div id="foodDisplay" class="d-none mt-4"></div>
  </div>
{% endblock %}

{% block scripts %}
{{ super() }}

<script>
  document.getElementById("generateEncounterBtn").addEventListener("click", async () => {
    const includeWeird = document.getElementById("includeWeird").checked;
    const includeMagical = document.getElementById("includeMagical").checked;

    try {
      const response = await fetch(`/food-item?weird=${includeWeird}&magical=${includeMagical}`);
      if (!response.ok) {
        const errText = await response.text();
        console.error("Server error:", errText);
        throw new Error(`Server responded with ${response.status}`);
      }

      const data = await response.json();
      const display = document.getElementById("foodDisplay");

      if (display) {
        display.innerHTML = `
          <div class="d-flex justify-content-center">
            <div class="card p-4 shadow text-center" style="max-width: 600px;">
              <h5 class="fw-bold mb-3">${data.food_item}</h5>
              <p class="mb-3">${data.description}</p>
              ${data.weird ? `<hr><p class="fw-bold mb-1">ðŸŒ€ Weird Side Effect</p><p class="mb-3">${data.weird}</p>` : ''}
              ${data.magical ? `<hr><p class="fw-bold mb-1">âœ¨ Magical Side Effect</p><p class="mb-3">${data.magical}</p>` : ''}
            </div>
          </div>
        `;

        display.classList.remove("d-none");
        display.classList.add("show");
      }
    } catch (err) {
      console.error("Error fetching food item:", err);
    }
  });
</script>
{% endblock %}
