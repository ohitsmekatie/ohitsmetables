{% extends "base.html" %}

{# Rumor Generator - mirrors Food page structure/styles #}
{% block content %}
  <div class="text-center">
    <h1 class="mb-4 display-5">
      <i class="fas fa-comments me-2"></i> Rumor Generator
    </h1>

    <!-- Options -->
    <div class="row justify-content-center mb-3">
      <div class="col-md-4">
        <label for="rumorCount" class="form-label fw-bold">How many?</label>
        <select id="rumorCount" class="form-select form-select-magic">
          <option value="1">1</option>
          <option value="3" selected>3</option>
          <option value="5">5</option>
        </select>
      </div>
    </div>

    <!-- Generate button -->
    <div class="row justify-content-center mb-4">
      <div class="col-md-4 text-center">
        <button id="generateEncounterBtn">
          <i class="fas fa-wand-sparkles me-2"></i> Generate Rumors
        </button>
      </div>
    </div>

    <!-- Result display -->
    <div id="rumorDisplay" class="encounter-card text-start d-none mt-4"></div>
  </div>
{% endblock %}

{% block scripts %}
{{ super() }}

<script>
// Rumor generator: fetches /rumors-list and renders into the encounter-card
document.getElementById("generateEncounterBtn").addEventListener("click", async () => {
  const count = document.getElementById("rumorCount").value || 3;

  try {
    const response = await fetch(`/rumors-list?count=${encodeURIComponent(count)}`);
    if (!response.ok) throw new Error(await response.text());

    const data = await response.json();
    const display = document.getElementById("rumorDisplay");

    // Normalize payload
    const rumors = Array.isArray(data.rumors) ? data.rumors : [];
    if (rumors.length === 0) {
      display.innerHTML = `<p class="mb-0">No rumors found.</p>`;
    } else {
      const items = rumors.map(r => `<li>${r}</li>`).join("");
      display.innerHTML = `
        <ul class="mb-0">${items}</ul>
      `;
    }

    display.classList.remove("d-none");
    display.classList.add("show");
  } catch (err) {
    console.error("Error fetching rumors:", err);
  }
});
</script>
{% endblock %}
